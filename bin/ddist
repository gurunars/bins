#!/bin/bash
if [ ! -d "$DEB_REPO_DIR" ]; then
    echo "DEB_REPO_DIR does not point to existing directory is: '$DEB_REPO_DIR'"
    exit 1
fi

pkgs=$DEB_REPO_DIR/pkgs

if [ ! -d "$pkgs" ]; then
    echo "Creating repo folder $pkgs"
    mkdir $pkgs
fi

dpkg-buildpackage -rfakeroot -uc -us -sa -tc -D -A -I.git
cd ..
mv *.changes $pkgs
mv *.deb $pkgs

cd $pkgs
dpkg-scanpackages . /dev/null | gzip -9c > Packages.gz

echo "Source list entry: 'deb file:$pkgs ./'"
